@startuml
!pragma useNewPackage
hide empty members

package ska.cdm.messages.subarray_node {
	package scan.py <<Rectangle>> {
		class ScanRequest {
			scan_duration : datetime.timedelta
	  	}
		note top of ScanRequest
			This class is the input argument
			for ""SubArrayNode.Scan()""
		end note

	}
	note top of scan.py
		The JSON payload for ""SubArrayNode.Scan()""
		is simple and can be contained in a single
		Python module.

		The response from ""SubArrayNode.Scan()""
		is unstructured, hence there is no Response
		class defined in this module.
	end note

	package configure {

		package core.py <<Rectangle>> {

			class Target {
				coord : astropy.SkyCoord
				name : str
			}

			class PointingConfiguration
			PointingConfiguration *-- Target

			class DishConfiguration {
				receiver_band : ReceiverBand
			}

			enum ReceiverBand {
				BAND_1
				BAND_2
				BAND_5A
				BAND_5B
			}

		}

		package csp.py <<Rectangle>> {

			enum FSPFunctionMode {
				CORR
				PSS-BF
				PST-BF
				VLBI
			}

			class FSPConfiguration {
				fsp_id : int
				function_mode : FSPFunctionMode
				frequency_slice_id : int
				integration_time : int
				corr_bandwidth : int
				channel_average_map : List[Tuple]
			}

			class CSPConfiguration {
				receiver_band : core.ReceiverBand
			}
			CSPConfiguration *-- "*" FSPConfiguration

		}

		package sdp.py <<Rectangle>> {

			class SDPWorkflow {
				id : str
				type : str
				version : str
			}

			class SDPParameters {
				num_stations : int
				num_channels : num_channels
				num_polarisation : int
				freq_start_hz : float
				freq_end_hz : float
			}
			SDPParameters --- "*" Target

			class SDPScan {
				field_id : int
				interval_ms : int
			}

			class SDPScanParameters
			SDPScanParameters *-- SDPScan

			class ProcessingBlockConfiguration {
				sb_id : int
				sbi_id : int
			}
			ProcessingBlockConfiguration *-- SDPParameters
			ProcessingBlockConfiguration *-- SDPWorkflow
			note left of ProcessingBlockConfiguration
				bug: ""sb_id"" should be
				renamed ""pb_id"" as it's
				meant to refer to the
				Processing Block ID
			end note

			class SDPConfiguration
			SDPConfiguration *-- "*" ProcessingBlockConfiguration
			SDPConfiguration *-- SDPScanParameters
		}

		package ~__init__.py {
			class ConfigureRequest {
				scan_id : int
			}
			ConfigureRequest *-- PointingConfiguration
			ConfigureRequest *-- DishConfiguration
			ConfigureRequest *-- CSPConfiguration
			ConfigureRequest *-- SDPConfiguration

			note top of ConfigureRequest
				This ""Request"" class is the input
				argument for
				""SubArrayNode.Configure()"".
			end note
		}
	}
	note top of configure
		The JSON payload for ""SubArrayNode.Configure()""
		is complex so it is coded as a package containing
		modules split roughly along the system Element
		boundaries.

		The response from ""SubArrayNode.Configure()""
		is unstructured, hence there is no Response class
		defined in this package.
	end note


}
note top of ska.cdm.messages.subarray_node
	The ""ska.cdm.messages.subarray_node"" package
	contains object models for the JSON payloads
	passed as arguments to, and responses returned
	by, the TMC SubArrayNode Tango device.
end note

@enduml